# FullFunnelChart

–ö–æ–º–ø–æ–Ω–µ–Ω—Ç –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–æ–π –≤–æ—Ä–æ–Ω–∫–∏-—Ç—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫–∞ —Å –±–æ–∫–æ–≤–æ–π –ø–∞–Ω–µ–ª—å—é –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫–æ–Ω–≤–µ—Ä—Å–∏–∏ –ø–æ —ç—Ç–∞–ø–∞–º –ø—Ä–æ–¥–∞–∂.

## –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

- ‚úÖ –ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è –≤–æ—Ä–æ–Ω–∫–∞ –∏–∑ 5 —Ç—Ä–∞–ø–µ—Ü–∏–π (CSS clip-path)
- ‚úÖ –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å —Å–ø—Ä–∞–≤–∞ —Å –û—Ç–∫–∞–∑–∞–º–∏ –∏ –ü–æ–¥–æ–≥—Ä–µ–≤–æ–º
- ‚úÖ Framer Motion –∞–Ω–∏–º–∞—Ü–∏–∏ (fadeIn, slideUp, hover)
- ‚úÖ –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å: hover —ç—Ñ—Ñ–µ–∫—Ç—ã + callback –Ω–∞ –∫–ª–∏–∫
- ‚úÖ –¶–≤–µ—Ç–æ–≤–∞—è –∏–Ω–¥–∏–∫–∞—Ü–∏—è red zones (–∫—Ä–∞—Å–Ω—ã–π < 60%, –∂–µ–ª—Ç—ã–π 60-70%, –∑–µ–ª–µ–Ω—ã–π > 70%)
- ‚úÖ –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –¥–∏–∑–∞–π–Ω
- ‚úÖ Dark mode –ø–æ–¥–¥–µ—Ä–∂–∫–∞
- ‚úÖ –ì—Ä–∞–¥–∏–µ–Ω—Ç–Ω—ã–µ backgrounds –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —ç—Ç–∞–ø–∞

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

```tsx
import { FullFunnelChart } from '@/components/analytics/FullFunnelChart'
import { calculateFullFunnel, type FunnelTotals } from '@/lib/calculations/funnel'

function MyPage() {
  const totals: FunnelTotals = {
    zoom: 150,
    pzm: 90,
    vzm: 54,
    contract: 40,
    deals: 30,
    sales: 28,
    refusals: 15,
    warming: 25,
  }

  const { funnel, sideFlow } = calculateFullFunnel(totals)

  return (
    <FullFunnelChart
      funnel={funnel}
      sideFlow={sideFlow}
      onStageClick={(stage) => console.log('Clicked:', stage)}
    />
  )
}
```

## Props

| Prop           | –¢–∏–ø                             | –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π | –û–ø–∏—Å–∞–Ω–∏–µ                              |
| -------------- | ------------------------------- | ------------ | ------------------------------------- |
| `funnel`       | `FunnelStage[]`                 | –î–∞           | –ú–∞—Å—Å–∏–≤ —ç—Ç–∞–ø–æ–≤ –≤–æ—Ä–æ–Ω–∫–∏ (5 —ç–ª–µ–º–µ–Ω—Ç–æ–≤)   |
| `sideFlow`     | `SideFlow`                      | –î–∞           | –î–∞–Ω–Ω—ã–µ –æ—Ç–∫–∞–∑–æ–≤ –∏ –ø–æ–¥–æ–≥—Ä–µ–≤–∞            |
| `onStageClick` | `(stage: FunnelStage) => void`  | –ù–µ—Ç          | Callback –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ —ç—Ç–∞–ø –≤–æ—Ä–æ–Ω–∫–∏    |

## –¢–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö

```typescript
interface FunnelStage {
  stage: string          // –ù–∞–∑–≤–∞–Ω–∏–µ —ç—Ç–∞–ø–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, "Zoom –ó–∞–ø–∏—Å–∏")
  value: number          // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ª—é–¥–µ–π –Ω–∞ —ç—Ç–æ–º —ç—Ç–∞–ø–µ
  conversion: number     // –ü—Ä–æ—Ü–µ–Ω—Ç –∫–æ–Ω–≤–µ—Ä—Å–∏–∏ –æ—Ç –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ —ç—Ç–∞–ø–∞
  isRedZone: boolean     // –§–ª–∞–≥ –∫—Ä–∞—Å–Ω–æ–π –∑–æ–Ω—ã (–∫–æ–Ω–≤–µ—Ä—Å–∏—è –Ω–∏–∂–µ –ø–æ—Ä–æ–≥–∞)
}

interface SideFlow {
  refusals: {
    count: number        // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç–∫–∞–∑–æ–≤
    rate: number         // –ü—Ä–æ—Ü–µ–Ω—Ç –æ—Ç–∫–∞–∑–æ–≤ –æ—Ç –ü–ó–ú –ü—Ä–æ–≤–µ–¥–µ–Ω–æ
  }
  warming: {
    count: number        // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ª—é–¥–µ–π –≤ –ø–æ–¥–æ–≥—Ä–µ–≤–µ
  }
}
```

## –í–∏–∑—É–∞–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                                         ‚îÇ   –ë–û–ö–û–í–ê–Ø –ü–ê–ù–ï–õ–¨  ‚îÇ
‚îÇ   ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà      ‚îÇ                   ‚îÇ
‚îÇ      Zoom –ó–∞–ø–∏—Å–∏ (100%)                 ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ           ‚Üì                             ‚îÇ  ‚îÇ   –û–¢–ö–ê–ó–´     ‚îÇ ‚îÇ
‚îÇ   ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà              ‚îÇ  ‚îÇ   15 —á–µ–ª     ‚îÇ ‚îÇ
‚îÇ      –ü–ó–ú –ü—Ä–æ–≤–µ–¥–µ–Ω–æ (60%)                ‚îÇ  ‚îÇ   16.7%      ‚îÇ ‚îÇ
‚îÇ           ‚Üì                             ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îÇ   ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà                      ‚îÇ                   ‚îÇ
‚îÇ      –í–ó–ú –ü—Ä–æ–≤–µ–¥–µ–Ω–æ (60%)                ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ           ‚Üì                             ‚îÇ  ‚îÇ  –ü–û–î–û–ì–†–ï–í    ‚îÇ ‚îÇ
‚îÇ   ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà                            ‚îÇ  ‚îÇ   25 —á–µ–ª     ‚îÇ ‚îÇ
‚îÇ      –†–∞–∑–±–æ—Ä –¥–æ–≥–æ–≤–æ—Ä–∞ (74%)              ‚îÇ  ‚îÇ   üë•üë•üë•     ‚îÇ ‚îÇ
‚îÇ           ‚Üì                             ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îÇ   ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà                              ‚îÇ                   ‚îÇ
‚îÇ      –°–¥–µ–ª–∫–∏ (75%)                       ‚îÇ                   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## –¶–≤–µ—Ç–æ–≤–∞—è —Å—Ö–µ–º–∞

- **–ó–µ–ª—ë–Ω—ã–π (#10B981)**: –∫–æ–Ω–≤–µ—Ä—Å–∏—è >= 70%
- **–ñ—ë–ª—Ç—ã–π (#F59E0B)**: –∫–æ–Ω–≤–µ—Ä—Å–∏—è 60-70%
- **–ö—Ä–∞—Å–Ω—ã–π (#EF4444)**: –∫–æ–Ω–≤–µ—Ä—Å–∏—è < 60% (red zone)

## –ê–Ω–∏–º–∞—Ü–∏–∏

1. **–ü–æ—è–≤–ª–µ–Ω–∏–µ —ç—Ç–∞–ø–æ–≤**: fadeIn + slideUp —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π (0.1s * –∏–Ω–¥–µ–∫—Å)
2. **Hover –Ω–∞ —ç—Ç–∞–ø–µ**: scale(1.02) + shadow glow
3. **Progress bar –æ—Ç–∫–∞–∑–æ–≤**: —à–∏—Ä–∏–Ω–∞ –∞–Ω–∏–º–∏—Ä—É–µ—Ç—Å—è –æ—Ç 0 –¥–æ –∑–Ω–∞—á–µ–Ω–∏—è –∑–∞ 1s
4. **–ò–∫–æ–Ω–∫–∏ –ø–æ–¥–æ–≥—Ä–µ–≤–∞**: scale –æ—Ç 0 –¥–æ 1 —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π (0.6s + 0.05s * –∏–Ω–¥–µ–∫—Å)

## –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å

- **Desktop**: grid layout `[1fr 300px]` (–æ—Å–Ω–æ–≤–Ω–∞—è –≤–æ—Ä–æ–Ω–∫–∞ + –±–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å 300px)
- **Mobile**: –ú–æ–∂–Ω–æ –æ–±–µ—Ä–Ω—É—Ç—å –≤ responsive container –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `grid-cols-1` –¥–ª—è –º–æ–±–∏–ª–æ–∫

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å API

```tsx
async function FunnelPage({ employeeId }: { employeeId: number }) {
  const response = await fetch(`/api/analytics/funnel?employeeId=${employeeId}`)
  const data = await response.json()

  const totals: FunnelTotals = {
    zoom: data.zoom_total,
    pzm: data.pzm_total,
    vzm: data.vzm_total,
    contract: data.contract_total,
    deals: data.deals_total,
    sales: data.sales_total,
    refusals: data.refusals_total,
    warming: data.warming_total,
  }

  const { funnel, sideFlow } = calculateFullFunnel(totals)

  return <FullFunnelChart funnel={funnel} sideFlow={sideFlow} />
}
```

## –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

- `framer-motion`: –∞–Ω–∏–º–∞—Ü–∏–∏
- `lucide-react`: –∏–∫–æ–Ω–∫–∏ (AlertTriangle, Users, TrendingDown, Flame, XCircle)
- `@/lib/calculations/funnel`: —É—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Ä–∞—Å—á—ë—Ç–∞ –≤–æ—Ä–æ–Ω–∫–∏ –∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

## CSS –∫–ª–∞—Å—Å—ã

- `glass-card`: glassmorphism —ç—Ñ—Ñ–µ–∫—Ç (–æ–ø—Ä–µ–¥–µ–ª—ë–Ω –≤ `app/globals.css`)
- Tailwind CSS utility classes –¥–ª—è –≤—Å–µ–≥–æ –æ—Å—Ç–∞–ª—å–Ω–æ–≥–æ

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

–°–º. —Ñ–∞–π–ª `FullFunnelChart.example.tsx` –¥–ª—è –ø–æ–ª–Ω—ã—Ö –ø—Ä–∏–º–µ—Ä–æ–≤:
- –ë–∞–∑–æ–≤–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å API
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–æ–≤ –Ω–∞ —ç—Ç–∞–ø—ã

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```tsx
import { render, screen, fireEvent } from '@testing-library/react'
import { FullFunnelChart } from './FullFunnelChart'

test('renders funnel stages', () => {
  const mockFunnel = [
    { stage: 'Zoom –ó–∞–ø–∏—Å–∏', value: 150, conversion: 100, isRedZone: false },
    { stage: '–ü–ó–ú –ü—Ä–æ–≤–µ–¥–µ–Ω–æ', value: 90, conversion: 60, isRedZone: false },
  ]
  const mockSideFlow = {
    refusals: { count: 15, rate: 16.7 },
    warming: { count: 25 },
  }

  render(<FullFunnelChart funnel={mockFunnel} sideFlow={mockSideFlow} />)

  expect(screen.getByText('Zoom –ó–∞–ø–∏—Å–∏')).toBeInTheDocument()
  expect(screen.getByText('–ü–ó–ú –ü—Ä–æ–≤–µ–¥–µ–Ω–æ')).toBeInTheDocument()
  expect(screen.getByText('15')).toBeInTheDocument() // –û—Ç–∫–∞–∑—ã
  expect(screen.getByText('25')).toBeInTheDocument() // –ü–æ–¥–æ–≥—Ä–µ–≤
})
```

## –§–∞–π–ª—ã

- `FullFunnelChart.tsx` - –æ—Å–Ω–æ–≤–Ω–æ–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç
- `FullFunnelChart.example.tsx` - –ø—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- `FullFunnelChart.README.md` - —ç—Ç–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- `@/lib/calculations/funnel.ts` - —É—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Ä–∞—Å—á—ë—Ç–æ–≤
